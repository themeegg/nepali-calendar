var $=jQuery;!function($){$.fn.NepaliCalendar=function(attributes){$.each($(this),function(){function getCookie(e){for(var t=e+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var n=a[r];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}function ShowPopHoverDate(e){$(e).find(".popoverDate").remove();var t=$(e).closest("table").find(".CurrentDateAndMonth ").attr("data-date").split("/");$(e).append('<div class="popoverDate"><span>'+self.NumberToLanguageDigit(t[0])+"/"+self.NumberToLanguageDigit(t[1])+"/"+$(e).html()+"</span></div>")}function RemovePophover(e){$(e).find(".popoverDate").remove()}var $selector=$(this),Lang;if(document.cookie="PatroLangCookie=np",""==(Lang=getCookie("PatroLangCookie"))&&(Lang="np"),"en"==Lang)var PatroLang={Prev:"Prev",CurrentMonth:"January",Next:"Next",FirstDay:"Sun",SecondDay:"Mon",ThirdDay:"Tue",FourthDay:"Wed",FifthDay:"Thu",SixthDay:"Fri",SeventhDay:"Sat",One:"1",Two:"2",Three:"3",Four:"4",Five:"5",Six:"6",Seven:"7",Eight:"8",Nine:"9",Zero:"0",CurrentYear:"2015"};else if("np"==Lang)var PatroLang={Prev:" ",CurrentMonth:"वैशाख",Next:" ",FirstDay:"आईत",SecondDay:"सोम",ThirdDay:"मंगल",FourthDay:"बुध",FifthDay:"बिही",SixthDay:"शुक्र",SeventhDay:"शनी",One:"१",Two:"२",Three:"३",Four:"४",Five:"५",Six:"६",Seven:"७",Eight:"८",Nine:"९",Zero:"०",CurrentYear:"२०७२"};var BaseDigit=new Array("Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"),NPDigit={One:"१",Two:"२",Three:"३",Four:"४",Five:"५",Six:"६",Seven:"७",Eight:"८",Nine:"९",Zero:"०"},ENDigit={One:"1",Two:"2",Three:"3",Four:"4",Five:"5",Six:"6",Seven:"7",Eight:"8",Nine:"9",Zero:"0"},NPWeekDay=new Array("आईत","सोम","मंगल","बुध","बिही","शुक्र","शनी"),NPMonth=new Array("बैशाख","जेठ","अषाढ","श्रावण","भाद्र","आश्विन","कार्तिक","मङ्सिर","पौष","माघ","फाल्गुन","चैत्र"),ENMonth=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),GlobalObj,RefDate={BS:"2000/01/01",AD:"1943/04/14"},BS={};BS[2e3]=new Array(30,32,31,32,31,30,30,30,29,30,29,31),BS[2001]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2002]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2003]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2004]=new Array(30,32,31,32,31,30,30,30,29,30,29,31),BS[2005]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2006]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2007]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2008]=new Array(31,31,31,32,31,31,29,30,30,29,29,31),BS[2009]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2010]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2011]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2012]=new Array(31,31,31,32,31,31,29,30,30,29,30,30),BS[2013]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2014]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2015]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2016]=new Array(31,31,31,32,31,31,29,30,30,29,30,30),BS[2017]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2018]=new Array(31,32,31,32,31,30,30,29,30,29,30,30),BS[2019]=new Array(31,32,31,32,31,30,30,30,29,30,29,31),BS[2020]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2021]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2022]=new Array(31,32,31,32,31,30,30,30,29,29,30,30),BS[2023]=new Array(31,32,31,32,31,30,30,30,29,30,29,31),BS[2024]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2025]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2026]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2027]=new Array(30,32,31,32,31,30,30,30,29,30,29,31),BS[2028]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2029]=new Array(31,31,32,31,32,30,30,29,30,29,30,30),BS[2030]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2031]=new Array(30,32,31,32,31,30,30,30,29,30,29,31),BS[2032]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2033]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2034]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2035]=new Array(30,32,31,32,31,31,29,30,30,29,29,31),BS[2036]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2037]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2038]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2039]=new Array(31,31,31,32,31,31,29,30,30,29,30,30),BS[2040]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2041]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2042]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2043]=new Array(31,31,31,32,31,31,29,30,30,29,30,30),BS[2044]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2045]=new Array(31,32,31,32,31,30,30,29,30,29,30,30),BS[2046]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2047]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2048]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2049]=new Array(31,32,31,32,31,30,30,30,29,29,30,30),BS[2050]=new Array(31,32,31,32,31,30,30,30,29,30,29,31),BS[2051]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2052]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2053]=new Array(31,32,31,32,31,30,30,30,29,29,30,30),BS[2054]=new Array(31,32,31,32,31,30,30,30,29,30,29,31),BS[2055]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2056]=new Array(31,31,32,31,32,30,30,29,30,29,30,30),BS[2057]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2058]=new Array(30,32,31,32,31,30,30,30,29,30,29,31),BS[2059]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2060]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2061]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2062]=new Array(30,32,31,32,31,31,29,30,29,30,29,31),BS[2063]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2064]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2065]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2066]=new Array(31,31,31,32,31,31,29,30,30,29,29,31),BS[2067]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2068]=new Array(31,31,32,32,31,30,30,29,30,29,30,30),BS[2069]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2070]=new Array(31,31,31,32,31,31,29,30,30,29,30,30),BS[2071]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2072]=new Array(31,32,31,32,31,30,30,29,30,29,30,30),BS[2073]=new Array(31,32,31,32,31,30,30,30,29,29,30,31),BS[2074]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2075]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2076]=new Array(31,32,31,32,31,30,30,30,29,29,30,30),BS[2077]=new Array(31,32,31,32,31,30,30,30,29,30,29,31),BS[2078]=new Array(31,31,31,32,31,31,30,29,30,29,30,30),BS[2079]=new Array(31,31,32,31,31,31,30,29,30,29,30,30),BS[2080]=new Array(31,32,31,32,31,30,30,30,29,29,30,30),BS[2081]=new Array(31,31,32,32,31,30,30,30,29,30,30,30),BS[2082]=new Array(30,32,31,32,31,30,30,30,29,30,30,30),BS[2083]=new Array(31,31,32,31,31,30,30,30,29,30,30,30),BS[2084]=new Array(31,31,32,31,31,30,30,30,29,30,30,30),BS[2085]=new Array(31,32,31,32,30,31,30,30,29,30,30,30),BS[2086]=new Array(30,32,31,32,31,30,30,30,29,30,30,30),BS[2087]=new Array(31,31,32,31,31,31,30,30,29,30,30,30),BS[2088]=new Array(30,31,32,32,30,31,30,30,29,30,30,30),BS[2089]=new Array(30,32,31,32,31,30,30,30,29,30,30,30),BS[2090]=new Array(30,32,31,32,31,30,30,30,29,30,30,30);var self={GlobalDate:"",init:function(){var e=new Date;if("en"==Lang)self.GlobalDate=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();else if("np"==Lang){var t=self.AdToBsDate(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate());self.GlobalDate=t.substr(0,t.lastIndexOf("/"))}this.populateDate(),this.CreateCalenderElement(),this.bindCalenderEvents(),this.getDate()},bindCalenderEvents:function(){$selector.on("click",".PatroCenter.CurrentDateAndMonth",function(){var e=$(this);if(!(e.find("select").length>0)){var t=$('<select class="yearSelectionDropDown">');$.each(BS,function(e,a){t.append('<option data-year="'+e+'">'+self.NumberToLanguageDigit(e)+"</option>")});for(var a=$('<select class="monthSelectionDropDown">'),r=0;r<12;r++)a.append('<option data-month="'+(r+1)+'">'+NPMonth[r]+"</option>");e.html(t),e.append(a);var n=e.attr("data-date").split("/");e.find(".yearSelectionDropDown").find('option[data-year="'+n[0]+'"]').prop("selected",!0),e.find(".monthSelectionDropDown").find('option[data-month="'+n[1]+'"]').prop("selected",!0);var o=$selector.find(".PatroCenter.CurrentDateAndMonth"),i=o.find(".yearSelectionDropDown").find("option:selected").attr("data-year"),l=o.find(".monthSelectionDropDown").find("option:selected").attr("data-month");o.find(".yearSelectionDropDown").on("change",function(){i=$(this).find("option:selected").attr("data-year"),self.JumpToDate(i+"/"+l+"/1")}),o.find(".monthSelectionDropDown").on("change",function(){l=$(this).find("option:selected").attr("data-month"),self.JumpToDate(i+"/"+l+"/1")})}})},JumpToDate:function(e){var t=e.split("/");0==t[1]-1?(t[1]=12,t[0]=t[0]-1):t[1]=t[1]-1,$selector.find(".CurrentDateAndMonth").attr("data-date",t[0]+"/"+t[1]+"/"+t[2]),$selector.find("th.Next").trigger("click")},CreateCalenderElement:function(){var e='<div class="NepaliCalendarElement noselect">';return e+='<table id="NepaliCalendar">',e+='<thead><tr style="background:#ca4e4e; color:#fff;"><th class="noselect Prev">'+PatroLang.Prev+'</th><th data-date="'+self.GlobalDate+'" colspan="5" class="PatroCenter CurrentDateAndMonth noselect">'+PatroLang.CurrentYear+" "+PatroLang.CurrentMonth+'</th><th class="noselect Next">'+PatroLang.Next+"</th> </tr>",e+='<tr style="background:#ca4e4e; color:#fff;" ><th>'+PatroLang.FirstDay+"</th><th>"+PatroLang.SecondDay+"</th><th>"+PatroLang.ThirdDay+"</th><th>"+PatroLang.FourthDay+"</th><th>"+PatroLang.FifthDay+"</th><th>"+PatroLang.SixthDay+"</th><th>"+PatroLang.SeventhDay+"</th></tr></thead>",e+="<tbody>",e+="</tbody>",e+="</table>",$selector.append(e),e},getDate:function(){var FullDate=self.GlobalDate.split("/");PatroLang.CurrentYear=this.NumberToLanguageDigit(FullDate[0]),PatroLang.CurrentMonth=eval(Lang.toUpperCase()+"Month["+(parseInt(FullDate[1])-1)+"]"),this.populateMonth(self.GlobalDate,Lang)},populateDate:function(){var FullDate=self.GlobalDate.split("/");PatroLang.CurrentYear=this.NumberToLanguageDigit(FullDate[0]),PatroLang.CurrentMonth=eval(Lang.toUpperCase()+"Month["+(parseInt(FullDate[1])-1)+"]")},populateMonth:function(e,t){if("en"==t){var a=new Date(e);PatroWeekDay=a.getDay()+1,PatroYear=a.getFullYear(),PatroMonth=a.getMonth()+1,PatroDay=a.getDate(),NumberOfDays=new Date(PatroYear,PatroMonth+1,0).getDate()}else if("np"==t){NepaliDate=e.split("/"),PatroYear=NepaliDate[0],PatroMonth=NepaliDate[1]-1,PatroDay=NepaliDate[2],NumberOfDays=BS[PatroYear][PatroMonth];self.BsToAD(e);PatroWeekDay=self.BsToAD(e),PatroWeekDay=PatroWeekDay[PatroWeekDay.length-1]}WeekStartDay=NumberOfDays;var r=Math.floor(PatroDay/7),n=PatroDay-7*r;if(1==n)var o=PatroWeekDay;else{n=0==n?7:n;var i=PatroWeekDay;for(p=n;p<=n;p--){if(0==i&&(i=7),0==p){o=i+1;break}i--}}$patroBody=GlobalObj?$(GlobalObj).closest("table").find("tbody"):$selector.find("#NepaliCalendar tbody"),$patroBodyHTML="";var l=0,s=0;for(s=0;s<6;s++){for($patroBodyHTML+="<tr>",j=0;j<7;j++){var h="";if(PatroDay==l+1){var d=this.CurrentBsDate().split("/"),y=$selector.find("table#NepaliCalendar thead tr:first-child th:nth-child(2)").attr("data-date").split("/");d[0]==y[0]&&d[1]==y[1]&&d[2]==y[2]&&(h+="today")}6==j&&(h+=" week_holiday"),$patroBodyHTML+='<td class="'+h+'">',l<NumberOfDays&&(0==s&&o-1<=j&&(l++,$patroBodyHTML+=this.NumberToLanguageDigit(l)),s>0&&(l++,$patroBodyHTML+=this.NumberToLanguageDigit(l))),$patroBodyHTML+="</td>"}$patroBodyHTML+="</tr>"}$patroBody.html(""),$patroBody.append($patroBodyHTML),CurrentDate=PatroYear+"/"+(parseInt(PatroMonth)+1)+"/"+PatroDay,GlobalObj&&$(GlobalObj).closest("#NepaliCalendar").find(".CurrentDateAndMonth").html(PatroLang.CurrentYear+" "+PatroLang.CurrentMonth)},NumberToLanguageDigit:function(RawNumber){if(RawNumber=String(RawNumber),"en"==Lang)return RawNumber;var OutputNumber="";for(i=0;i<RawNumber.length;i++)OutputNumber+=eval(Lang.toUpperCase()+"Digit."+BaseDigit[RawNumber[i]]);return OutputNumber},CurrentBsDate:function(e){var t=null==e?new Date:e;return"np"==Lang?null!=e?(this.BsToAD(e).split("/"),e):this.AdToBsDate(t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()):"en"==Lang?t.getFullYear()+"/"+t.getMonth()+"/"+t.getDate()+(t.getDay()+1):void 0},getFirstDayOfMonth:function(){},AdToBsDate:function(e){var t=new Date(e).getDay()+1;console.log("ad is "+e);var a=(new Date(e)-new Date(RefDate.AD))/864e5,r=0,n="";return $.each(BS,function(e,o){if($.each(o,function(o,i){if(r+=i,a<r)return n=e+"/"+(o+1)+"/"+(i-(r-a)+1)+"/"+t,!1}),""!=n)return!1}),n},BsToAD:function(e){var t=e.split("/");t[1]=parseInt(t[1])-1,t[2]=parseInt(t[2])-1;var a=0,r=0;$.each(BS,function(e,n){if(parseInt(t[0])>=parseInt(e)&&($.each(n,function(n,o){if(parseInt(e)==parseInt(t[0])&&parseInt(n)==parseInt(t[1]))return parseInt([t[2]])<=o?a+=parseInt(t[2]):a+=parseInt(o),r=1,!1;a+=parseInt(o)}),1==r))return!1});var n=new Date(RefDate.AD);return n.setDate(n.getDate()+a),n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+"/"+(n.getDay()+1)},CurrentWeekDay:function(){return(new Date).getDay()},NepaliDate:function(){this.CurrentBsDate(),this.CurrentWeekDay()}};self.init(),$selector.on("click","#NepaliCalendar .Prev",function(){var currDate=$(this).parent("tr").find(".CurrentDateAndMonth").attr("data-date"),$Date=currDate.split("/"),Month,Year;1==parseInt($Date[1])?(Month=12,Year=parseInt($Date[0])-1):(Year=parseInt($Date[0]),Month=parseInt($Date[1])-1),self.GlobalDate=Year+"/"+Month+"/"+$Date[2],$(this).parent("tr").find(".CurrentDateAndMonth").attr("data-date",self.GlobalDate);var FullDate=self.GlobalDate.split("/");PatroLang.CurrentYear=self.NumberToLanguageDigit(FullDate[0]),PatroLang.CurrentMonth=eval(Lang.toUpperCase()+"Month["+(parseInt(FullDate[1])-1)+"]"),GlobalObj=this,self.getDate(),$.each($(this).closest(".NepaliCalendarElement"),function(){""==$(this).find("table tbody tr:first-child td:last-child").html()&&$(this).find("table tbody tr:first-child").remove(),""==$(this).find("table tbody tr:last-child td:first-child").html()&&$(this).find("table tbody tr:last-child").remove()})}),$selector.on("click","#NepaliCalendar .Next",function(){var currDate=$(this).parent("tr").find(".CurrentDateAndMonth").attr("data-date"),$Date=currDate.split("/"),Month,Year;12==parseInt($Date[1])?(Month=1,Year=parseInt($Date[0])+1):(Year=parseInt($Date[0]),Month=parseInt($Date[1])+1),self.GlobalDate=Year+"/"+Month+"/"+$Date[2],$(this).parent("tr").find(".CurrentDateAndMonth").attr("data-date",self.GlobalDate);var FullDate=self.GlobalDate.split("/");PatroLang.CurrentYear=self.NumberToLanguageDigit(FullDate[0]),PatroLang.CurrentMonth=eval(Lang.toUpperCase()+"Month["+(parseInt(FullDate[1])-1)+"]"),GlobalObj=this,self.getDate(),$.each($(this).closest(".NepaliCalendarElement"),function(){""==$(this).find("table tbody tr:first-child td:last-child").html()&&$(this).find("table tbody tr:first-child").remove(),""==$(this).find("table tbody tr:last-child td:first-child").html()&&$(this).find("table tbody tr:last-child").remove()})}),$.each($(".NepaliCalendarElement"),function(){""==$(this).find("table tbody tr:first-child td:last-child").html()&&$(this).find("table tbody tr:first-child").remove(),""==$(this).find("table tbody tr:last-child td:first-child").html()&&$(this).find("table tbody tr:last-child").remove()}),$("body").on("mouseover",".NepaliCalendarElement table tbody td:not(.NepaliCalendarElement table tbody td:empty)",function(e){"TD"==e.target.tagName&&ShowPopHoverDate(this)}),$("body").on("mouseleave",".NepaliCalendarElement table tbody td:not(.NepaliCalendarElement table tbody td:empty)",function(e){RemovePophover(this)})})}}(jQuery),$(function(){jQuery(".NepaliCalendar").NepaliCalendar({})});